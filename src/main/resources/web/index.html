<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <title>MaylinCraft Newsfeed</title>
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <!--[if lt IE 9]>
        <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <link href="css/styles.css" rel="stylesheet">
        <style>
            .nf-login-heading {
                background: -webkit-linear-gradient(#5ad137, black); /* For Safari 5.1 to 6.0 */
                background: -o-linear-gradient(#5ad137, black); /* For Opera 11.1 to 12.0 */
                background: -moz-linear-gradient(#5ad137, black); /* For Firefox 3.6 to 15 */
                background: linear-gradient(#5ad137, black); /* Standard syntax */
            }

            .nf-death-heading {
                background: -webkit-linear-gradient(red, black); /* For Safari 5.1 to 6.0 */
                background: -o-linear-gradient(red, black); /* For Opera 11.1 to 12.0 */
                background: -moz-linear-gradient(red, black); /* For Firefox 3.6 to 15 */
                background: linear-gradient(red, black); /* Standard syntax */
            }

            .nf-diamond-heading {
                background: -webkit-linear-gradient(#81bfbc, #192474); /* For Safari 5.1 to 6.0 */
                background: -o-linear-gradient(#81bfbc, #192474); /* For Opera 11.1 to 12.0 */
                background: -moz-linear-gradient(#81bfbc, #192474); /* For Firefox 3.6 to 15 */
                background: linear-gradient(#81bfbc, #192474); /* Standard syntax */
            }

            .nf-mcmmo-level-heading {
                background: -webkit-linear-gradient(orange, black); /* For Safari 5.1 to 6.0 */
                background: -o-linear-gradient(orange, black); /* For Opera 11.1 to 12.0 */
                background: -moz-linear-gradient(orange, black); /* For Firefox 3.6 to 15 */
                background: linear-gradient(orange, black); /* Standard syntax */
            }

            h6 {
                color: white;
            }

            .panel-heading {
                padding: 5px 13px;
                border: 0;
            }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-fixed-top header">
            <div class="col-md-12">
                <div class="navbar-header">
                    <a href="#" class="navbar-brand">Bootstrap</a>
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse1">
                    <i class="glyphicon glyphicon-search"></i>
                    </button>
                </div>
                <div class="collapse navbar-collapse" id="navbar-collapse1">
                    <form class="navbar-form pull-left">
                        <div class="input-group" style="max-width:470px;">
                            <input type="text" class="form-control" placeholder="Search" name="srch-term" id="srch-term">
                            <div class="input-group-btn">
                                <button class="btn btn-default btn-primary" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                            </div>
                        </div>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="http://www.bootply.com" target="_ext">Bootply+</a></li>
                        <li>
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-bell"></i></a>
                            <ul class="dropdown-menu">
                                <li><a href="#"><span class="badge pull-right">40</span>Link</a></li>
                                <li><a href="#"><span class="badge pull-right">2</span>Link</a></li>
                                <li><a href="#"><span class="badge pull-right">0</span>Link</a></li>
                                <li><a href="#"><span class="label label-info pull-right">1</span>Link</a></li>
                                <li><a href="#"><span class="badge pull-right">13</span>Link</a></li>
                            </ul>
                        </li>
                        <li><a href="#" id="btnToggle"><i class="glyphicon glyphicon-th-large"></i></a></li>
                        <li><a href="#"><i class="glyphicon glyphicon-user"></i></a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <div class="navbar navbar-default" id="subnav">
            <div class="col-md-12">
                <div class="navbar-header">
                    <a href="#" style="margin-left:15px;" class="navbar-btn btn btn-default btn-plus dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-home" style="color:#dd1111;"></i> Home <small><i class="glyphicon glyphicon-chevron-down"></i></small></a>
                    <ul class="nav dropdown-menu">
                        <li><a href="#"><i class="glyphicon glyphicon-user" style="color:#1111dd;"></i> Profile</a></li>
                        <li><a href="#"><i class="glyphicon glyphicon-dashboard" style="color:#0000aa;"></i> Dashboard</a></li>
                        <li><a href="#"><i class="glyphicon glyphicon-inbox" style="color:#11dd11;"></i> Pages</a></li>
                        <li class="nav-divider"></li>
                        <li><a href="#"><i class="glyphicon glyphicon-cog" style="color:#dd1111;"></i> Settings</a></li>
                        <li><a href="#"><i class="glyphicon glyphicon-plus"></i> More..</a></li>
                    </ul>
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse2">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse" id="navbar-collapse2">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="active"><a href="#">Posts</a></li>
                        <li><a href="#loginModal" role="button" data-toggle="modal">Login</a></li>
                        <li><a href="#aboutModal" role="button" data-toggle="modal">About</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <!--main-->
        <div class="container" id="main">
            <div class="row">
                <div id="nf-column0" class="col-md-4 col-sm-6">
                </div>
                <div id="nf-column1" class="col-md-4 col-sm-6">
                </div>
                <div id="nf-column2" class="col-md-4 col-sm-6">
                </div>
            </div>
            <!--/row-->
            <div class="clearfix"></div>
            <hr>
            <div class="col-md-12 text-center">
                <p><a href="http://www.bootply.com/download/90113" target="_ext">Download Google Plus Style Template</a><br><a href="http://bootply.com/templates" target="_ext">More Bootstrap Templates by @Bootply</a></p>
            </div>
            <hr>
        </div>
        <!--/main-->
        <!--login modal-->
        <div id="loginModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h2 class="text-center"><img src="https://lh5.googleusercontent.com/-b0-k99FZlyE/AAAAAAAAAAI/AAAAAAAAAAA/eu7opA4byxI/photo.jpg?sz=100" class="img-circle"><br>Login</h2>
                    </div>
                    <div class="modal-body">
                        <form class="form col-md-12 center-block">
                            <div class="form-group">
                                <input type="text" class="form-control input-lg" placeholder="Email">
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-control input-lg" placeholder="Password">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary btn-lg btn-block">Sign In</button>
                                <span class="pull-right"><a href="#">Register</a></span><span><a href="#">Need help?</a></span>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <div class="col-md-12">
                            <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--about modal-->
        <div id="aboutModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h2 class="text-center">About</h2>
                    </div>
                    <div class="modal-body">
                        <div class="col-md-12 text-center">
                            <a href="http://www.bootply.com/DwnjTNuvVt">This Bootstrap Template</a><br>was made with <i class="glyphicon glyphicon-heart"></i> by <a href="http://bootply.com/templates">Bootply</a>
                            <br><br>
                            <a href="https://github.com/iatek/bootstrap-google-plus">GitHub Fork</a>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" data-dismiss="modal" aria-hidden="true">OK</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- script references -->
        <script src="js/jquery-2.1.1.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/scripts.js"></script>
        <script src="js/jquery.timeago.js" type="text/javascript"></script>

        <script type="text/javascript">

            var startIndex, endIndex;
            var loginPanelNode, deathPanelNode, diamondPanelNode, levelUpPanelNode;

            document.addEventListener('scroll', function (event) {
                if (document.body.scrollHeight == 
                    document.body.scrollTop +        
                    window.innerHeight) {
                    
                    startIndex = endIndex;
                    endIndex += 16;
                    addStories(startIndex, endIndex);
                }
            });            

            $(function() {

                startIndex = 0;
                endIndex = 16;

                loginPanelNode = '';
                loginPanelNode += '<div class="panel panel-default">';
                loginPanelNode += '   <div class="panel-heading nf-login-heading">';
                loginPanelNode += '      <img src="https://minotar.net/avatar/nf-replace-name/32" class="pull-right">';
                loginPanelNode += '      <h6>Log In</h6>';
                loginPanelNode += '   </div>';
                loginPanelNode += '   <div>';
                loginPanelNode += '     <img class="img-responsive" src="images/creeperlove.jpg"/>';
                loginPanelNode += '   </div>';
                loginPanelNode += '   <div class="panel-body">';
                loginPanelNode += '      <div class="list-group">';
                loginPanelNode += '          <h2>nf-replace-name was <i>online</i></h2>';
                loginPanelNode += '          <br/>';
                loginPanelNode += '          nf-replace-length-descriptor';
                loginPanelNode += '          <br/>';
                loginPanelNode += '          <span style="color:grey"><i>nf-replace-time</i></span>';
                loginPanelNode += '      </div">';
                loginPanelNode += '   </div>';
                loginPanelNode += '</div>';

                deathPanelNode = '';
                deathPanelNode += '<div class="panel panel-default">';
                deathPanelNode += '   <div class="panel-heading nf-death-heading">';
                deathPanelNode += '      <img src="https://minotar.net/avatar/nf-replace-name/32" class="pull-right">';
                deathPanelNode += '      <h6>Killed in Action</h6>';
                deathPanelNode += '   </div>';
                deathPanelNode += '   <div>';
                deathPanelNode += '     <img class="img-responsive" src="images/skeleowned.jpg"/>';
                deathPanelNode += '   </div>';
                deathPanelNode += '   <div class="panel-body">';
                deathPanelNode += '      <div class="list-group">';
                deathPanelNode += '          <h2>nf-replace-death-message</h2>';
                deathPanelNode += '          <br/>';
                deathPanelNode += '          <span style="color:grey"><i>nf-replace-time</i></span>';
                deathPanelNode += '      </div">';
                deathPanelNode += '   </div>';
                deathPanelNode += '</div>';

                diamondPanelNode = '';
                diamondPanelNode += '<div class="panel panel-default">';
                diamondPanelNode += '   <div class="panel-heading nf-diamond-heading">';
                diamondPanelNode += '      <img src="https://minotar.net/avatar/nf-replace-name/32" class="pull-right">';
                diamondPanelNode += '      <h6>Diamonds Found</h6>';
                diamondPanelNode += '   </div>';
                diamondPanelNode += '   <div>';
                diamondPanelNode += '     <img class="img-responsive" src="images/diamondbreak.jpg"/>';
                diamondPanelNode += '   </div>';
                diamondPanelNode += '   <div class="panel-body">';
                diamondPanelNode += '      <div class="list-group">';
                diamondPanelNode += '          <h2>nf-replace-name found a vein of nf-replace-block-count Diamonds Blocks!</h2>';
                diamondPanelNode += '          <br/>';
                diamondPanelNode += '          <span style="color:grey"><i>nf-replace-time</i></span>';
                diamondPanelNode += '      </div">';
                diamondPanelNode += '   </div>';
                diamondPanelNode += '</div>';

                levelUpPanelNode = '';
                levelUpPanelNode += '<div class="panel panel-default">';
                levelUpPanelNode += '   <div class="panel-heading nf-mcmmo-level-heading">';
                levelUpPanelNode += '      <img src="https://minotar.net/avatar/nf-replace-name/32" class="pull-right">';
                levelUpPanelNode += '      <h6>McMMO Level Achievement</h6>';
                levelUpPanelNode += '   </div>';
                levelUpPanelNode += '   <div>';
                levelUpPanelNode += '     <img class="img-responsive" src="images/levelup.jpg"/>';
                levelUpPanelNode += '   </div>';
                levelUpPanelNode += '   <div class="panel-body">';
                levelUpPanelNode += '      <div class="list-group">';
                levelUpPanelNode += '          <h2>nf-replace-name achieved level nf-replace-level in nf-replace-skill!</h2>';
                levelUpPanelNode += '          <br/>';
                levelUpPanelNode += '          <span style="color:grey"><i>nf-replace-time</i></span>';
                levelUpPanelNode += '      </div">';
                levelUpPanelNode += '   </div>';
                levelUpPanelNode += '</div>';

                addStories(startIndex, endIndex);
            });

            var handleLoginNews = function(i, val) {

                var loginDesc = "Logged In";
                
                if(val.last_action == 'login') {
                    loginDesc = 'Is Online';
                }

                var lengthDesc;

                if(parseInt(val.play_time_minutes) > 60) {
                    lengthDesc = "for an hour or so";
                } else if(parseInt(val.play_time_minutes) > 120) {
                    lengthDesc = "for a couple of hours.";
                } else  {
                    lengthDesc = "for " + val.play_time_minutes + " minutes";
                }

                localPanelNode = '';

                localPanelNode = loginPanelNode.replace(/nf-replace-name/g, val.name);
                localPanelNode = localPanelNode.replace(/nf-replace-login/g, loginDesc);
                localPanelNode = localPanelNode.replace(/nf-replace-length-descriptor/g, lengthDesc);
                localPanelNode = localPanelNode.replace(/nf-replace-time/g, jQuery.timeago(val.login_time));

                var columnId = "#nf-column" + (i % 3);

                $(columnId).append(localPanelNode);
            }

            var handleDeathNews = function(i, val) {

                var loginDesc = "Suffered Death";

                localPanelNode = '';

                localPanelNode = deathPanelNode.replace(/nf-replace-name/g, val.name);
                localPanelNode = localPanelNode.replace(/nf-replace-login/g, loginDesc);
                localPanelNode = localPanelNode.replace(/nf-replace-length-descriptor/g, val.death_message);
                localPanelNode = localPanelNode.replace(/nf-replace-death-message/g, val.death_message);
                localPanelNode = localPanelNode.replace(/nf-replace-time/g, jQuery.timeago(val.time));

                var columnId = "#nf-column" + (i % 3);

                $(columnId).append(localPanelNode);
            }

            var handleMcmmoLevelUpNews = function(i, val) {

                var loginDesc = "Leveled up";

                localPanelNode = '';

                localPanelNode = levelUpPanelNode.replace(/nf-replace-name/g, val.name);
                localPanelNode = localPanelNode.replace(/nf-replace-login/g, loginDesc);
                localPanelNode = localPanelNode.replace(/nf-replace-skill/g, val.skill_type);
                localPanelNode = localPanelNode.replace(/nf-replace-level/g, val.level);
                localPanelNode = localPanelNode.replace(/nf-replace-time/g, jQuery.timeago(val.time));

                var columnId = "#nf-column" + (i % 3);

                $(columnId).append(localPanelNode);
            }

            var handleDiamondBreakNews = function(i, val) {

                var loginDesc = "Diamonds!";

                localPanelNode = '';

                localPanelNode = diamondPanelNode.replace(/nf-replace-name/g, val.name);
                localPanelNode = localPanelNode.replace(/nf-replace-login/g, loginDesc);
                localPanelNode = localPanelNode.replace(/nf-replace-block-count/g, val.block_count);
                localPanelNode = localPanelNode.replace(/nf-replace-time/g, jQuery.timeago(val.time));

                var columnId = "#nf-column" + (i % 3);

                $(columnId).append(localPanelNode);
            }

            var addStories = function(start, end) {
                $.get( "../data/newsfeed?startindex=" + start + "&endindex=" + end, function( data ) {
                    var localPanelNode;
                    var jsonObj = JSON.parse(data);
                    jQuery.each(jsonObj, function(i, val) {

                        if(typeof val.news_type != 'undefined' && val.news_type == 'login') {
                            handleLoginNews(i, val);        
                        } else if(typeof val.news_type != 'undefined' && val.news_type == 'death') {
                            handleDeathNews(i, val);        
                        } else if(typeof val.news_type != 'undefined' && val.news_type == 'mcmmo_levelup') {
                            handleMcmmoLevelUpNews(i, val);        
                        } else if(typeof val.news_type != 'undefined' && val.news_type == 'diamond_break') {
                            handleDiamondBreakNews(i, val);        
                        }
                    });
                });  
            }

        </script>
    </body>
</html>
